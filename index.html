<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test ChatSeller Widget - Boutique E-commerce</title>
  
  <!-- Meta tags pour simulation e-commerce -->
  <meta property="og:title" content="Le Jeu Pour les Couples - Boutique Test">
  <meta property="og:description" content="Jeu révolutionnaire pour renforcer les liens entre couples">
  <meta property="og:price:amount" content="14000">
  <meta property="og:price:currency" content="XOF">
  <meta name="chatseller-shop-id" content="12345678-1234-1234-1234-123456789abc">
  
  <!-- Préchargement DNS pour performance -->
  <link rel="dns-prefetch" href="//widget.chatseller.app">
  <link rel="dns-prefetch" href="//chatseller-api-production.up.railway.app">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .header {
      background: white;
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav {
      display: flex;
      list-style: none;
      gap: 2rem;
    }

    .nav a {
      text-decoration: none;
      color: #666;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: all 0.3s;
    }

    .nav a:hover {
      background: #f8f9fa;
      color: #667eea;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .test-banner {
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      text-align: center;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    .test-banner h2 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .test-banner p {
      opacity: 0.9;
      font-size: 1rem;
    }

    .product-section {
      background: white;
      border-radius: 16px;
      padding: 3rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }

    .product-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }

    .product-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: start;
    }

    .product-image {
      position: relative;
      width: 100%;
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
    }

    .product-image::after {
      content: '📦 Image Produit\A(Simulation E-commerce)';
      white-space: pre-line;
    }

    .product-info h1 {
      font-size: 2.5rem;
      font-weight: bold;
      color: #1a1a1a;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .product-rating {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .stars {
      display: flex;
      gap: 2px;
    }

    .star {
      color: #fbbf24;
      font-size: 1.2rem;
    }

    .rating-text {
      color: #666;
      font-size: 0.9rem;
    }

    .price {
      font-size: 2.2rem;
      font-weight: bold;
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 1.5rem;
    }

    .description {
      color: #666;
      line-height: 1.8;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }

    .features {
      margin-bottom: 2rem;
    }

    .features h3 {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #1a1a1a;
    }

    .features ul {
      list-style: none;
      padding: 0;
    }

    .features li {
      padding: 0.5rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #666;
    }

    .features li:before {
      content: "✅";
      font-size: 1rem;
    }

    .product-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
    }

    .quantity-btn {
      background: #f8f9fa;
      border: none;
      padding: 0.75rem 1rem;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      transition: background 0.3s;
      color: #667eea;
    }

    .quantity-btn:hover {
      background: #e9ecef;
    }

    .quantity-input {
      border: none;
      padding: 0.75rem;
      width: 80px;
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .btn {
      padding: 1rem 2rem;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
    }

    .widget-status {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .status-loading {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      color: #92400e;
    }

    .status-success {
      background: #d1fae5;
      border: 1px solid #10b981;
      color: #065f46;
    }

    .status-error {
      background: #fee2e2;
      border: 1px solid #ef4444;
      color: #991b1b;
    }

    .widget-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .control-btn {
      padding: 0.75rem 1rem;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s;
    }

    .control-btn:hover {
      background: #667eea;
      color: white;
    }

    .debug-info {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 1rem;
      font-family: monospace;
      font-size: 0.85rem;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .product-section {
        padding: 1.5rem;
      }

      .product-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      .product-info h1 {
        font-size: 2rem;
      }

      .price {
        font-size: 1.8rem;
      }

      .nav {
        display: none;
      }

      .widget-controls {
        grid-template-columns: 1fr;
      }
    }

    .floating-info {
      position: fixed;
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      z-index: 1000;
      max-width: 250px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .floating-info h4 {
      color: #667eea;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .floating-info p {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 0.25rem;
    }

    @media (max-width: 1024px) {
      .floating-info {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Info flottante pour développeurs -->
  <div class="floating-info">
    <h4>🧪 Mode Test</h4>
    <p><strong>Shop ID:</strong> Test UUID</p>
    <p><strong>API:</strong> Production</p>
    <p><strong>Détection:</strong> Auto</p>
    <p><strong>Console:</strong> F12 pour debug</p>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">🛍️ Boutique Test</div>
      <nav>
        <ul class="nav">
          <li><a href="#accueil">Accueil</a></li>
          <li><a href="#produits">Produits</a></li>
          <li><a href="#contact">Contact</a></li>
          <li><a href="#panier">Panier (0)</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Container principal -->
  <div class="container">
    <!-- Bannière de test -->
    <div class="test-banner">
      <h2>🧪 PAGE DE TEST CHATSELLER WIDGET</h2>
      <p>Cette page simule une boutique e-commerce pour tester le widget ChatSeller</p>
    </div>

    <!-- Statut du widget -->
    <div class="widget-status">
      <h3>📊 Statut du Widget ChatSeller</h3>
      <div id="widget-status-indicator" class="status-indicator status-loading">
        <span>🔄</span>
        <span>Chargement du widget en cours...</span>
      </div>
      
      <div class="widget-controls">
        <button class="control-btn" onclick="testWidgetConnection()">🔌 Tester Connexion</button>
        <button class="control-btn" onclick="showWidgetDebug()">🐛 Debug Info</button>
        <button class="control-btn" onclick="simulateProductView()">👁️ Simuler Vue Produit</button>
        <button class="control-btn" onclick="openWidgetManually()">💬 Ouvrir Widget</button>
      </div>
      
      <div id="debug-output" class="debug-info" style="display: none;"></div>
    </div>

    <!-- Section produit simulé -->
    <div class="product-section">
      <div class="product-grid">
        <!-- Image produit -->
        <div class="product-image" id="product-image">
          <!-- Image sera chargée ici -->
        </div>

        <!-- Informations produit -->
        <div class="product-info">
          <h1 id="product-title">Le Jeu Pour les Couples</h1>
          
          <div class="product-rating">
            <div class="stars">
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
            </div>
            <span class="rating-text">(127 avis clients)</span>
          </div>

          <div class="price" id="product-price">14 000 FCFA</div>

          <div class="description">
            <p>Découvrez ce jeu révolutionnaire conçu spécialement pour renforcer les liens entre couples. Avec plus de 200 questions et défis, ce jeu vous permettra de mieux vous connaître et de passer des moments inoubliables ensemble.</p>
          </div>

          <div class="features">
            <h3>Contenu du pack :</h3>
            <ul>
              <li>200+ cartes questions personnalisées</li>
              <li>Guide d'utilisation détaillé</li>
              <li>Livret de conseils relationnels</li>
              <li>Boîte de rangement premium</li>
              <li>Garantie satisfaction 30 jours</li>
            </ul>
          </div>

          <div class="product-actions">
            <div class="quantity-selector">
              <label><strong>Quantité :</strong></label>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="changeQuantity(-1)">−</button>
                <input type="number" id="quantity" class="quantity-input" value="1" min="1" max="10">
                <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
              </div>
            </div>

            <button class="btn btn-primary" onclick="addToCart()">
              🛒 Ajouter au panier
            </button>

            <button class="btn btn-secondary" onclick="buyNow()">
              ⚡ Acheter maintenant
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ WIDGET CHATSELLER - Configuration de test -->
  <script>
    // Configuration globale pour le widget
    window.ChatSellerConfig = {
      shopId: "12345678-1234-1234-1234-123456789abc", // UUID de test
      apiUrl: "http://localhost:3001", // URL de votre API locale
      theme: "modern",
      primaryColor: "#667eea",
      position: "bottom-right",
      buttonText: "💬 Parler au vendeur",
      language: "fr",
      autoDetectProduct: true
    };
  </script>

  <!-- Chargement du widget -->
  <script async src="/src/embed.ts" type="module"></script>

  <!-- Scripts de la page de test -->
  <script>
    let currentQuantity = 1;
    let widgetLoadAttempts = 0;
    const maxAttempts = 10;

    // Fonctions de la boutique simulée
    function changeQuantity(delta) {
      const input = document.getElementById('quantity');
      const newValue = parseInt(input.value) + delta;
      if (newValue >= 1 && newValue <= 10) {
        input.value = newValue;
        currentQuantity = newValue;
      }
    }

    function addToCart() {
      showSuccessMessage(`${currentQuantity} x "Le Jeu Pour les Couples" ajouté au panier !`);
      
      // Track avec le widget si disponible
      if (window.ChatSeller) {
        window.ChatSeller.track('add_to_cart', {
          productName: 'Le Jeu Pour les Couples',
          quantity: currentQuantity,
          price: 14000
        });
      }
    }

    function buyNow() {
      showSuccessMessage(`Redirection vers le checkout pour ${currentQuantity} exemplaire(s)`);
      
      // Track avec le widget si disponible
      if (window.ChatSeller) {
        window.ChatSeller.track('buy_now_clicked', {
          productName: 'Le Jeu Pour les Couples',
          quantity: currentQuantity,
          price: 14000
        });
      }
    }

    function showSuccessMessage(message) {
      const existingMsg = document.querySelector('.success-message');
      if (existingMsg) existingMsg.remove();

      const msgDiv = document.createElement('div');
      msgDiv.className = 'success-message';
      msgDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        z-index: 10000;
        font-weight: 500;
        animation: slideInRight 0.5s ease-out;
      `;
      msgDiv.textContent = message;

      document.body.appendChild(msgDiv);

      setTimeout(() => {
        msgDiv.style.animation = 'slideOutRight 0.5s ease-in forwards';
        setTimeout(() => msgDiv.remove(), 500);
      }, 3000);
    }

    // Fonctions de test du widget
    function checkWidgetStatus() {
      widgetLoadAttempts++;
      const statusIndicator = document.getElementById('widget-status-indicator');
      
      if (window.ChatSeller) {
        statusIndicator.className = 'status-indicator status-success';
        statusIndicator.innerHTML = '<span>✅</span><span>Widget ChatSeller chargé et opérationnel</span>';
        
        // Log des informations de debug
        console.log('✅ ChatSeller widget loaded:', window.ChatSeller.getDebugInfo());
        
        // Track le chargement de page
        window.ChatSeller.track('test_page_loaded', {
          timestamp: new Date().toISOString(),
          userAgent: navigator.userAgent
        });
        
      } else if (widgetLoadAttempts < maxAttempts) {
        setTimeout(checkWidgetStatus, 1000);
      } else {
        statusIndicator.className = 'status-indicator status-error';
        statusIndicator.innerHTML = '<span>❌</span><span>Échec du chargement du widget après ' + maxAttempts + ' tentatives</span>';
      }
    }

    async function testWidgetConnection() {
      if (!window.ChatSeller) {
        alert('❌ Widget non chargé. Attendez le chargement ou vérifiez la console.');
        return;
      }

      const result = await window.ChatSeller.testConnection();
      
      const message = result.success 
        ? `✅ Connexion réussie (${result.latency}ms)`
        : `❌ Connexion échouée: ${result.error}`;
      
      alert(message);
      console.log('🔌 Connection test result:', result);
    }

    function showWidgetDebug() {
      if (!window.ChatSeller) {
        alert('❌ Widget non chargé');
        return;
      }

      const debugOutput = document.getElementById('debug-output');
      const debugInfo = window.ChatSeller.getDebugInfo();
      
      debugOutput.textContent = JSON.stringify(debugInfo, null, 2);
      debugOutput.style.display = debugOutput.style.display === 'none' ? 'block' : 'none';
      
      console.log('🐛 Debug info:', debugInfo);
    }

    function simulateProductView() {
      if (!window.ChatSeller) {
        alert('❌ Widget non chargé');
        return;
      }

      window.ChatSeller.track('product_viewed', {
        productId: 'jeu-couples-001',
        productName: 'Le Jeu Pour les Couples',
        productPrice: 14000,
        category: 'Jeux et Divertissement',
        timestamp: new Date().toISOString()
      });

      showSuccessMessage('📊 Événement "Vue Produit" envoyé');
      console.log('👁️ Product view event tracked');
    }

    function openWidgetManually() {
      if (!window.ChatSeller) {
        alert('❌ Widget non chargé');
        return;
      }

      // Simuler un clic sur le bouton du widget
      const widgetButton = document.querySelector('.cs-chat-trigger-button');
      if (widgetButton) {
        widgetButton.click();
        console.log('💬 Widget opened manually');
      } else {
        alert('❌ Bouton du widget non trouvé');
      }
    }

    // Initialisation de la page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Page de test ChatSeller chargée');
      console.log('🆔 Shop ID de test:', window.ChatSellerConfig?.shopId);
      
      // Commencer à vérifier le statut du widget
      setTimeout(checkWidgetStatus, 1000);
      
      // Ajouter des styles d'animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInRight {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(100%); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    });

    // Debug global pour la console
    window.debugChatSeller = {
      info: () => window.ChatSeller?.getDebugInfo(),
      test: () => window.ChatSeller?.testConnection(),
      track: (event, data) => window.ChatSeller?.track(event, data),
      config: () => window.ChatSeller?.currentConfig
    };

    console.log('💡 Commandes debug disponibles: window.debugChatSeller');
  </script>
</body>
</html>