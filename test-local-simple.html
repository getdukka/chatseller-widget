<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Widget ChatSeller - VERSION LOCALE</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 2rem;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 2.5rem;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }

    .header {
      text-align: center;
      margin-bottom: 2.5rem;
      padding: 2rem;
      background: linear-gradient(135deg, #E91E63, #9C27B0);
      color: white;
      border-radius: 12px;
    }

    .product-demo {
      margin: 2rem 0;
      padding: 2rem;
      border: 2px dashed #dee2e6;
      border-radius: 12px;
      text-align: center;
    }

    .product-demo h2 {
      color: #495057;
    }

    .cta-button {
      background: #1a1a1a;
      color: white;
      border: none;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      margin: 1rem 0.5rem;
    }

    .cta-button:hover {
      background: #333;
      transform: translateY(-2px);
    }

    .logs {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 2rem;
      font-family: monospace;
      font-size: 0.9rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .log-entry {
      padding: 0.25rem 0;
    }

    .success { color: #28a745; font-weight: bold; }
    .error { color: #dc3545; font-weight: bold; }
    .warning { color: #ffc107; }
    .info { color: #17a2b8; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß™ Test Widget ChatSeller</h1>
      <p><strong>VERSION LOCALE</strong> - Serveur: http://localhost:8080</p>
    </div>

    <div class="product-demo">
      <h2>Produit de d√©monstration</h2>
      <p>S√©rum Anti-√Çge Premium</p>
      <p style="font-size: 1.5rem; font-weight: bold; color: #E91E63;">49,90 ‚Ç¨</p>

      <!-- Le widget s'affichera ici -->
      <div id="chatseller-widget"></div>

      <button class="cta-button">üõí Ajouter au panier</button>
    </div>

    <div class="logs">
      <div id="logs-container">
        <div class="log-entry info">üìä En attente du chargement du widget...</div>
      </div>
    </div>
  </div>

  <!-- ========== WIDGET CHATSELLER - VERSION LOCALE ========== -->
  <script>
  (function() {
    'use strict';

    console.log('üîß [LOCAL TEST] D√©marrage du test local');

    // Fonction de logging
    function log(message, type = 'info') {
      const container = document.getElementById('logs-container');
      const timestamp = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${timestamp}] ${message}`;
      container.appendChild(entry);
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    log('üöÄ D√©but initialisation ChatSeller (version locale)', 'info');

    // Configuration du widget
    window.ChatSellerConfig = {
      shopId: 'b4b2639b-687b-4263-a4ce-f0e8ace1ab63',
      agentId: 'dfa9c078-829e-497a-8d66-4c7210279709',
      apiUrl: 'https://chatseller-api-production.up.railway.app',
      buttonText: 'Parler √† une conseill√®re beaut√©',
      primaryColor: '#E91E63',
      position: 'above-cta',
      // ‚úÖ PAS de floatingPosition sur page produit - uniquement position
      theme: 'modern',
      language: 'fr',
      borderRadius: 'full',
      autoDetectProduct: true,
      debug: true,
      forceDisplay: true, // ‚úÖ Force l'affichage m√™me hors page produit
      agentConfig: {
        id: 'dfa9c078-829e-497a-8d66-4c7210279709',
        name: 'Katia',
        title: 'Conseill√®re beaut√©',
        welcomeMessage: 'Bonjour ! Je suis Katia, votre conseill√®re beaut√©. Comment puis-je vous aider ?',
        fallbackMessage: 'Je transmets votre question √† notre √©quipe beaut√©.',
        personality: 'friendly'
      }
    };

    log('‚úÖ Configuration d√©finie', 'success');

    // Protection anti-double chargement
    if (window.ChatSellerInitialized) {
      log('‚ö†Ô∏è Widget d√©j√† initialis√©', 'warning');
      return;
    }
    window.ChatSellerInitialized = true;

    // Chargement du widget depuis le serveur LOCAL
    function loadWidget() {
      if (window.ChatSellerLoaded) {
        log('‚ö†Ô∏è Widget d√©j√† charg√©', 'warning');
        return;
      }
      window.ChatSellerLoaded = true;

      log('üì¶ Chargement de embed.js depuis localhost:8080...', 'info');

      const script = document.createElement('script');
      // ‚úÖ SERVEUR LOCAL avec cache-busting
      script.src = 'http://localhost:8080/dist/embed.js?v=' + Date.now();
      script.async = true;

      script.onload = function() {
        log('‚úÖ embed.js charg√© avec succ√®s !', 'success');

        // Attendre que window.ChatSeller soit disponible
        let attempts = 0;
        function tryInit() {
          attempts++;
          log(`üîÑ Tentative d'initialisation #${attempts}`, 'info');

          if (window.ChatSeller && typeof window.ChatSeller.init === 'function') {
            log('‚úÖ window.ChatSeller.init trouv√© !', 'success');

            try {
              window.ChatSeller.init(window.ChatSellerConfig);
              log('üéâ Widget initialis√© avec succ√®s !', 'success');
              log('üëÄ Cherchez le bouton du widget sur la page', 'info');
            } catch (initError) {
              log('‚ùå Erreur lors de l\'initialisation: ' + initError.message, 'error');
              console.error('D√©tails erreur:', initError);
            }
          } else if (attempts < 20) {
            log('‚è≥ window.ChatSeller.init pas encore disponible, nouvelle tentative...', 'warning');
            setTimeout(tryInit, 300);
          } else {
            log('‚ùå window.ChatSeller.init introuvable apr√®s 20 tentatives (6 secondes)', 'error');
            log('üí° V√©rifiez que le serveur local tourne sur localhost:8080', 'warning');
          }
        }

        tryInit();
      };

      script.onerror = function(e) {
        log('‚ùå Erreur lors du chargement de embed.js', 'error');
        log('‚ö†Ô∏è V√©rifiez que le serveur local tourne: http://localhost:8080', 'error');
        log('üí° Testez dans le navigateur: http://localhost:8080/dist/embed.js', 'info');
        console.error('Erreur script:', e);
      };

      log('üìù Ajout du script au DOM...', 'info');
      document.head.appendChild(script);
    }

    // Attendre le DOM
    if (document.readyState === 'loading') {
      log('‚è≥ Attente du chargement complet du DOM...', 'info');
      document.addEventListener('DOMContentLoaded', loadWidget);
    } else {
      log('‚úÖ DOM d√©j√† charg√©, lancement imm√©diat', 'success');
      setTimeout(loadWidget, 100);
    }

  })();
  </script>
  <!-- ========== FIN WIDGET ========== -->

</body>
</html>
